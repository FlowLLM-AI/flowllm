factor_step1_prompt: |
  # 角色定义
  你是一名金融分析专家，专注于金融因子传导路径的逻辑推导与分析。
  
  # 背景信息
  ## 搜索内容
  {search_content}
  
  ## 分析对象
  目标公司：{name}
  业务板块：{segment}
  
  ## 当前金融因子逻辑图
  {mermaid_graph}
  
  # 任务说明
  基于**当前金融因子逻辑图**，评估逻辑链的完整性，识别信息缺口或可深化的分析环节。
  若存在需要补充的信息，请生成搜索查询列表（query list），每条查询将独立调用一次搜索API。
  
  ## 查询生成规则
  1. **查询格式要求**：
     - 每条查询必须简洁明确，仅包含关键词，使用空格分隔
     - 单次最多生成 {max_search_cnt} 条查询
  
  2. **避免冗余搜索**：
     - 若逻辑路径起点已是明确的具体事件、政策文件或新闻事实，无需为该因子再生成上游查询
     - 例如："2025年欧盟碳关税正式实施"已足够明确，无需再搜索其成因
  
  3. **关键分析维度**：
     - **上游维度**：原材料价格、生产设备、供应商状况、成本结构变化
     - **企业自身维度**：产能扩张、技术突破、资本开支、运营效率改善
     - **下游维度**：终端需求变化、客户行业景气度、订单量与订单结构
     - **政策维度**：行业监管政策、政府补贴、关税与贸易壁垒
     - **公司动态维度**：财务报告、官方公告、管理层指引、产能规划
     - **新闻事件维度**：行业重大新闻、公司重要事件、政府政策发布、国际市场动态
  
  4. **分析视角差异**：
     - **未盈利公司**：重点关注营收驱动因子，包括市场份额提升、行业总需求增长、新市场开拓等
     - **盈利公司**：重点关注利润驱动因子，包括成本优化、产品结构升级、议价能力提升等
     - **估值直接影响**：关注宏观因素对估值的直接作用，例如：
       - 无风险利率下降 → DCF模型折现率降低 → 未来现金流现值提升 → 估值提升
       - 风险偏好改善 → 估值溢价提升
  
  5. **终止条件**：
     - 若当前逻辑链已完整且无需补充新信息，则返回空列表 `[]`
  
  # 输出格式
  ## 思考过程
  [在此进行逐步分析，包括：
  - 当前逻辑图的完整性评估
  - 识别出的信息缺口或可展开环节
  - 需要补充的信息及其必要性说明]
  
  ## 搜索查询列表
  ```json
  [
    "查询关键词1 关键词2",
    "查询关键词3 关键词4",
    "查询关键词5 关键词6"
  ]
  ```
  
  请严格按照上述格式输出，先进行思考分析，再给出搜索查询列表。

factor_step2_prompt: |
  # 角色定义
  你是一名金融分析专家，专注于金融因子传导路径的逻辑推导与图谱构建。
  
  # 背景信息
  ## 搜索内容
  {search_content}
  
  ## 分析对象
  目标公司：{name}
  业务板块：{segment}
  
  ## 当前时间
  {current_time}
  
  ## 当前金融因子逻辑图
  {mermaid_graph}

  # 任务说明
  根据**搜索内容**中提供的信息，更新现有的**金融因子逻辑图**。
  更新操作包括：新增逻辑路径、删除过时路径、修改现有路径、在路径中新增/删除/修改因子节点。
  
  ## 更新规则与要求
  
  ### 1. 因子定义规范
  - 每个因子必须采用 **[实体 + 变化方向]** 的格式，确保具体、可观测
  - 因子描述应简洁明确，例如：
    - ✓ "铜价上涨"、"美联储降息"、"公司新建产能投产"
    - ✗ "原材料"、"政策变化"、"市场环境"（过于抽象）
  
  ### 2. 图谱结构要求
  - **统一终点**：所有逻辑路径的终点必须统一为 `A[{name} {segment} 估值增加]`
  - **路径长度限制**：每条逻辑路径最多包含 6 个因子节点（含起点和终点）
  - **起点要求**：每条路径的起点应为不需进一步向上追溯的客观因子，例如：
    - 政策事件："2025年新能源汽车补贴政策发布"
    - 市场事件："全球半导体供应短缺"
    - 公司事件："公司完成新产线建设"
  
  ### 3. 特殊情况处理
  - 若起点因子为"利润贡献提升"等中间结果性因子，必须继续向上追溯至根源性因子
  - 例如："利润贡献提升"应追溯至"成本降低"或"售价提升"等更上游因子
  
  ### 4. 图谱维护原则
  - **合并重复因子**：相同含义的因子应合并为一个节点
  - **删除过时因子**：与当前时间或搜索内容不符的因子应删除
  - **保持原图**：若搜索内容中无有效新信息，则直接原样输出当前图谱
  
  ### 5. 分析视角指引
  - **未盈利公司**：侧重营收驱动路径
    - 市场份额扩大 → 营收增长 → 估值提升
    - 行业需求爆发 → 公司订单增加 → 营收增长 → 估值提升
  
  - **盈利公司**：侧重利润驱动路径
    - 原材料价格下降 → 成本降低 → 利润率提升 → 估值提升
    - 产品结构优化 → 毛利率提升 → 利润增长 → 估值提升
  
  - **估值直接驱动路径**：
    - 央行降息 → 无风险利率下降 → DCF折现率降低 → 估值提升
    - 行业政策利好 → 市场风险偏好提升 → 估值溢价扩大 → 估值提升
  
  ## 逻辑路径示例
  ```
  美联储加息 -> 市场利率上升 -> 银行净息差扩大 -> 利息收入增加 -> [xx银行 借贷业务 估值增加]
  ```
  
  # 输出格式
  ## 思考过程
  [在此进行逐步分析，包括：
  - 搜索内容中的关键信息提取
  - 对现有图谱的影响评估
  - 拟进行的更新操作及理由]
  
  ## 更新后的金融因子逻辑图
  ```mermaid
  graph LR;
  B[因子1] --> C[因子2]
  C --> A[{name} {segment} 估值增加]
  D[因子3] --> E[因子4]
  E --> A
  ```
  
  请严格按照上述格式输出，先进行思考分析，再给出更新后的图谱。


factor_transmission_prompt: |
  # 因子传导路径分析任务

  ## 分析对象
  目标公司：{name}
  业务板块：{segment}

  [no_first]## 搜索内容
  [no_first]{search_content}

  ## 现有因子传导逻辑图
  {mermaid_graph}

  # 任务概述
  围绕 **{name}** 的 **{segment}** 业务，构建并迭代树状结构的**因子传导路径图**。
  每条路径应从**宏观、行业或公司层面的可观测因子**出发，通过清晰的因果逻辑链，最终传导至 `[{name} {segment} 估值增加]`。
  
  **标准路径示例**：
  ```
  美联储加息 -> 市场利率上升 -> 银行净息差扩大 -> 利息收入增加 -> [xx银行 借贷业务 估值增加]
  ```

  ---

  ## 任务一：更新因子传导逻辑图
  
  ### 任务目标
  根据 **搜索内容** 中的信息，更新现有的 **因子传导逻辑图**。
  
  ### 更新要求
  1. **因子规范性**：
     - 每个因子必须是 **具体、可观察的实体及其变化方向**
     - 正确示例："铜价上涨"、"美联储降息"、"公司新建产能投产"
     - 错误示例："市场环境"、"政策因素"（过于抽象）
  
  2. **路径结构要求**：
     - 所有路径必须以 `[{name} {segment} 估值增加]` 为唯一终点
     - 单条路径最多包含 6 个因子节点
     - 路径起点应为明确的事件、政策或新闻，无需进一步向上追溯
  
  3. **图谱维护原则**：
     - 合并语义重复的因子节点
     - 删除与当前时间不符或已过时的因子
     - 若搜索内容无有效信息，则保持原图不变，直接原样输出
  
  4. **特殊情况处理**：
     - 若路径起点为"利润贡献提升"等中间结果性因子，需继续追溯至根本驱动因素

  ---

  ## 任务二：生成搜索查询列表
  
  ### 任务目标
  基于 **更新后的因子传导逻辑图**，识别信息缺口或可深化的分析环节，生成搜索查询列表。
  
  ### 查询生成原则
  1. **避免冗余搜索**：
     - 若路径起点已是明确的具体事件、政策或新闻（如"2025年欧盟碳关税正式实施"），则无需为该因子生成上游查询
  
  2. **关键分析维度**：
     - **上游维度**：原材料价格、生产设备、供应商状况、成本结构
     - **企业自身维度**：产能变化、技术进展、资本开支、运营效率
     - **下游维度**：终端需求、客户行业景气度、订单数据
     - **政策维度**：行业监管、政府补贴、贸易政策
     - **公司动态维度**：财报数据、官方公告、管理层指引、产能规划
  
  3. **查询格式要求**：
     - 每条查询应简洁明确，仅包含关键词，空格分隔
     - 单次最多生成 {max_search_cnt} 条查询
  
  4. **终止条件**：
     - 若当前逻辑链已完整且无需补充信息，则返回空列表 `[]`

  ---

  # 输出格式

  ## 任务一：思考过程
  [分析搜索内容对现有图谱的影响，说明拟进行的更新操作]

  ## 任务一：更新后的因子传导逻辑图
  ```mermaid
  graph LR;  
  B[因子1] --> C[因子2]
  C --> A[{name} {segment} 估值增加]
  D[因子3] --> A
  ```
  
  ## 任务二：思考过程
  [分析当前图谱的信息缺口，说明需要补充的搜索方向]
  
  ## 任务二：搜索查询列表
  ```json
  [
    "关键词1 关键词2",
    "关键词3 关键词4"
  ]
  ```

  请严格按照上述格式输出，逐步完成两个任务。


init_mermaid_graph: |
  ```mermaid
  graph LR;  
  A[{name} {segment} 估值增加]
  ```

